<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>Album example for Bootstrap</title>

    <!-- Bootstrap core CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">

    <!-- Custom styles for this template -->
    <link href="stylesheets/album.css" rel="stylesheet">
  </head>

  <body>


    <main role="main">
        <section class="text-center">
        <div class="container">
                <a href="#" class="btn btn-primary my-2" data-toggle="modal" data-target="#createModal">Add new
                    celebrity</a>
                <!--<a href="#" class="btn btn-secondary my-2">Secondary action</a>-->
        </div>
    </section>
 
      <div class="album py-5 bg-light">
        <div class="container" id ="123">

          <div class="row" id = "celebrities-group">

          </div>
        </div>
      </div>

    </main>



    <!-- Create Modal -->
    <div class="modal fade" id="createModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" >Add new celebrity</h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">
            <span>Image link</span><input name="imagelink" id = "image-link"><br>
            <span>Name</span><input name="name" id="name"><br>
            <span>Description</span><input name="description" id="description"><br>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
            <button type="button" class="btn btn-primary" data-dismiss="modal" id ="add-celebrity"> Add</button>
          </div>
        </div>
      </div>
    </div>




    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script  src="https://cdnjs.cloudflare.com/ajax/libs/handlebars.js/4.0.11/handlebars.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/holder/2.9.4/holder.js"></script>



    <script id="entry-template" type="text/x-handlebars-template">      
            <div class="col-md-4" id={{id}}>
                <img class="card-img-top rounded-circle" src="{{image_url}}" alt="{{id}}" width="350" height="350"/>
                <div class="card-body">
                  <p class="card-text" style="color:#5D92FF;font-weight:bold;font-style: italic;padding-left: 120px">{{name}}</p>
                  <div class="d-flex justify-content-between align-items-center">
                    <div class="btn-group" style="padding-left: 100px">
                      <button type="button"  class="btn btn-danger" onclick="del({{id}})" >Delete</button>
                      <button type="button" class="btn btn-sm btn-primary" data-toggle="modal" data-target="#Update{{id}}">Edit</button>
                    </div>
                  </div>
                </div>
          </div> 

          <div id="Update{{id}}"  class="modal fade" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                  <div class="modal-dialog" role="document">
                    <div class="modal-content">
                      <div class="modal-header">
                        <h5 class="modal-title" >Edit a celebrity </h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                          <span aria-hidden="true">&times;</span>
                        </button>
                      </div>
                      <div class="modal-body">
                        <input type="hidden" name="id" value = {{id}}>               
                        <span>Image link</span><input value="{{image_url}}" id ="image-link{{id}}"><br>
                        <span>Name</span><input value="{{name}}" id="name{{id}}"><br>
                        <span>Description</span><input value={{description}} id = "description{{id}}"><br>
                      </div>
                      <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                        <button type = "button" class="btn btn-primary" data-dismiss="modal" onclick ="UpdateInfor({{id}})"> Confirm </button>
                      </div>
                    </div>
                  </div>
           </div>
  

     </script>



    <script type="text/javascript">
      var source   = document.getElementById("entry-template").innerHTML;
      var template = Handlebars.compile(source); // trả về cả chuỗi html

      load();


      function del(Delid)
      {
          celebrities = Delid;
        $.ajax({
            type: 'DELETE',
            url: "api/celebrities/"+Delid,

        })
        document.getElementById(Delid).remove(); 
      }

      function load()
      {     

            $.ajax(
            {
              url: 'api/celebrities/',
              type: 'get',
              contentType: "application/json; charset=utf-8", 
              success:function(data)
              { 
                 var items = "";
                  $.each(data, function (key, val) {
                      items += template(val); 
                  });            
                  $("#celebrities-group").html(items);
              },
              error:function()
              {
                console.log("error");
              },
            });
     }

     $('#add-celebrity').on(
        'click',
        function (evt) {
          console.log("OKAY");
            $.ajax({
                type: "POST",
                url: "api/celebrities/",
                data: JSON.stringify({
                    image_url: $("#image-link").val(),
                    name: $("#name").val(),
                    description: $("#description").val()
                }),
                contentType: "application/json; charset=utf-8",
                success: function (data) {
                    load();
                }
            });

        }
     );

     function UpdateInfor(Upid)
     {
         var imglink = "#image-link"+Upid;
         var name = "#name"+Upid;
         var description = "#description"+Upid;

         var dataCeleb = {
                    id: Upid,
                    image_url: $(imglink).val(),
                    name: $(name).val(),
                    description: $(description).val()
         };

         $.ajax({
                type: "PUT",
                url: "api/celebrities/"+Upid,
                data: JSON.stringify(dataCeleb),
                contentType: "application/json; charset=utf-8",
                  success: function (data) {
                    load();
                }
          });
     }



    $('#update-celebrity').on('click',function(evt){
        console.log("up");
        $.ajax({
          type:'PUT',

          url:'api/celebrities/:celebrityId',

          data:JSON.stringify(
          {
            id : $("id").val(),
            image_url: $("#image-link").val(),
            name: $("#name").val(),
            description: $("#description").val()
          }),

          contentType: "application/json; charset=utf-8",

          success: function (data) {
                    load();
                }
        });
      }
     );
    </script>
  </body>
</html>
